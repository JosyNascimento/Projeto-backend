<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/main.css">
    <title>Produtos</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .admin-controls {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .admin-controls h2 {
            margin-top: 0;
        }
        .edit-button, .delete-button {
            margin-left: 5px;
            font-size: 0.8em;
        }
        .edit-form {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        .edit-form input[type="text"],
        .edit-form input[type="number"] {
            width: calc(100% - 10px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .add-product-form input[type="text"],
        .add-product-form input[type="number"] {
            width: calc(100% - 10px);
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .buy-button-admin {
            display: none !important;
        }
    </style>
</head>

        {{#if isAdmin}}
            <section class="admin-controls mt-5">
                <h2>Adicionar Novo Produto</h2>
                <form id="addProductForm" class="addProductForm">
                    <input type="text" id="newProductTitle" placeholder="Nome do Produto" required>
                    <input type="text" id="newProductDescription" placeholder="Descrição" required>
                    <input type="number" step="0.01" id="newProductPrice" placeholder="Preço" required>
                    <button type="submit" class="btn btn-success">Adicionar Produto</button>
                </form>
            </section>
        {{/if}}
    </main>

   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const socket = io();

       function addToCart(productId, cartId) {
    const isAdmin = document.querySelector('main').dataset.isAdmin === 'true';
    if (isAdmin) {
        alert("Administradores não podem adicionar produtos ao carrinho.");
        return;
    }

    fetch(`/api/carts/${cartId}/product/${productId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ quantity: 1 }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            alert("Produto adicionado ao carrinho!");
            // Atualize o carrinho ou redirecione, se necessário
        } else {
            alert("Erro ao adicionar ao carrinho.");
        }
    })
    .catch(error => {
        console.error("Erro ao adicionar ao carrinho:", error);
        alert("Erro ao adicionar ao carrinho.");
    });
}



        // Event listeners para editar e deletar
        document.addEventListener('DOMContentLoaded', () => {
            const productList = document.getElementById('productList');
            const addProductForm = document.getElementById('addProductForm');
            const isAdmin = document.querySelector('main').dataset.isAdmin === 'true';

            if (addProductForm && !isAdmin) {
                addProductForm.style.display = 'none';
            }

            if (productList) {
                productList.addEventListener('click', (e) => {
                    if (e.target.classList.contains('delete-button')) {
                        const productId = e.target.dataset.productId;
                        if (confirm(`Tem certeza que deseja deletar o produto com ID: ${productId}?`)) {
                            socket.emit('deleteProduct', productId);
                        }
                    } else if (e.target.classList.contains('edit-button')) {
                        const productId = e.target.dataset.productId;
                        const editForm = document.getElementById(`editForm-${productId}`);
                        if (editForm) {
                            editForm.style.display = 'block';
                            editForm.querySelector('.cancel-edit').addEventListener('click', () => {
                                editForm.style.display = 'none';
                            });
                            editForm.addEventListener('submit', (event) => {
                                event.preventDefault();
                                const form = event.target;
                                const formData = new FormData(form);
                                const updatedProduct = Object.fromEntries(formData.entries());
                                socket.emit('updateProduct', updatedProduct);
                                editForm.style.display = 'none';
                            });
                        }
                    }
                });
            }

            if (addProductForm && isAdmin) {
                addProductForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const title = document.getElementById('newProductTitle').value;
                    const description = document.getElementById('newProductDescription').value;
                    const price = document.getElementById('newProductPrice').value;
                    const newProduct = { title, description, price };
                    socket.emit('addProduct', newProduct);
                    addProductForm.reset();
                });
            }
        });
    </script>
</body>
</html>
